machine:
  environment:
    PATH: ~/.roswell/bin:${PATH}

dependencies:
  pre:
    - curl -L https://raw.githubusercontent.com/snmsts/roswell/master/scripts/install-for-ci.sh | sh
    - case $CIRCLE_NODE_INDEX in
        0) ros use sbcl-bin ;;
        1) ros install ccl-bin;
           ros use ccl-bin ;;
      esac
    - ros run -- --version
  override:
    - git clone https://github.com/fukamachi/prove ~/lisp/prove
    - ros -l ~/lisp/prove/prove.asd install prove
    - rm -rf ~/.roswell/local-projects/js
    - ros run -e '(ql:quickload :cl-js)' -q
    - (cd ~/.roswell/local-projects ; git clone https://github.com/akapav/js.git)
  cache_directories:
    - ~/.roswell

test:
  override:
    - run-prove *-test.asd
    