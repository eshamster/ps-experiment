machine:
  environment:
    PATH: ~/.roswell/bin:${PATH}

dependencies:
  environment:
    COVERAGE_EXCLUDE: t
  pre:
    - case $CIRCLE_NODE_INDEX in
        0) LISP=sbcl-bin ;
           curl -L https://raw.githubusercontent.com/snmsts/roswell/master/scripts/install-for-ci.sh | sh ;;
        1) LISP=ccl-bin ;
           curl -L https://raw.githubusercontent.com/snmsts/roswell/master/scripts/install-for-ci.sh | sh ;;
      esac
  override:
    - ros install prove
  cache_directories:
    - ~/.roswell

test:
  override:
    - ros run -- --version
    - case $CIRCLE_NODE_INDEX in
        0) OVERALLS=true ;
           run-prove *-test.asd ;;
        *) run-prove *-test.asd ;;
      esac
    